<div class="form-container">
    <nz-page-header nzTitle="Add Purchase" nzSubtitle="Create new purchase entry">
        <nz-breadcrumb [nzAutoGenerate]="true" nz-page-header-breadcrumb>
        </nz-breadcrumb>
    </nz-page-header>
    <!-- BEGIN :: FORM SECTION -->
    <form nz-form nzLayout="vertical" [formGroup]="form" class="ant-advanced-search-form">
        <div formGroupName="purchaseMaster" nz-row nzGutter="26">
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Bill No.</nz-form-label>
                    <nz-form-control>
                        <input readonly nzDisabled [disabled]="true" nz-input placeholder="Bill no."
                            formControlName="billNo" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Save Date</nz-form-label>
                    <nz-form-control>
                        <input readonly [disabled]="true" nz-input placeholder="Date" formControlName="saveDate" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Supplier Bill No</nz-form-label>
                    <nz-form-control>
                        <input nz-input placeholder="Bill no." formControlName="supplierBillNo" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Supplier Save Date</nz-form-label>
                    <nz-form-control>
                        <input appBsDateInput nz-input placeholder="Date" formControlName="supplierSaveDate" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label> Type </nz-form-label>
                    <nz-select nz-input placeholder="Select pay type" formControlName="payTypeId">
                        @for (item of payTypeSignal(); track $index) {
                        <nz-option [nzValue]="item.id" [nzLabel]="item.name"></nz-option>
                        }

                    </nz-select>
                </nz-form-item>
            </div>
            @if(mode ==='add') {
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Supplier </nz-form-label>
                    <nz-select nz-input placeholder="Select supplier" formControlName="supplierId">
                        @for (item of supplierListSignal(); track item.supplierId) {
                        <nz-option [nzValue]="item.supplierId" [nzLabel]="item.name"></nz-option>
                        }
                    </nz-select>
                </nz-form-item>
            </div>
            }
            @if(mode ==='edit') {
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Supplier </nz-form-label>
                    <nz-select nz-input placeholder="Select supplier" nzDisabled formControlName="supplierId">
                        @for (item of supplierListSignal(); track item.supplierId) {
                        <nz-option [nzValue]="item.supplierId" [nzLabel]="item.name"></nz-option>
                        }
                    </nz-select>
                </nz-form-item>
            </div>
            }
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <!-- RED COLOR INDICATOR -->
                <nz-form-item>
                    <nz-form-label>Total Amount</nz-form-label>
                    <nz-form-control>
                        <input class="totalAmount" disabled nz-input placeholder="Total Amount"
                            [value]="totalAmountSignal()" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="8">
                <nz-form-item>
                    <nz-form-label>Remarks</nz-form-label>
                    <nz-form-control>
                        <textarea nzAutosize rows="4" nz-input placeholder="Remarks"
                            formControlName="remarks"></textarea>

                    </nz-form-control>
                </nz-form-item>
            </div>
            <!-- formarray -->
        </div>
        <nz-divider></nz-divider>

        <div formArrayName="selectedStockList">
            <div *ngFor="let skill of inventoryList.controls let i=index">
                <div [formGroupName]="i">
                    <div nz-row nzGutter="24">
                        <div nz-col [nzXs]="24" [nzSm]="12" [nzMd]="6" [nzLg]="6">
                            <nz-form-item>
                                <nz-form-label>Product Name </nz-form-label>
                                <nz-select nz-input [nzShowSearch]="true" placeholder="Select product"
                                    formControlName="selectedItem" (ngModelChange)="patchMedicineValue(i, $event)">
                                    >
                                    @for (item of inventoryListSignal(); track item.stockMasterId) {
                                    <nz-option [nzValue]="item" [nzLabel]="item.name"></nz-option>
                                    }
                                </nz-select>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzXs]="12" [nzSm]="6" [nzMd]="3" [nzLg]="3">
                            <nz-form-item>
                                <nz-form-label>Qty.</nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input min="1" placeholder="Quantity" formControlName="qty"
                                        (input)="onValueChange(i)" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <div nz-col [nzXs]="12" [nzSm]="6" [nzMd]="3" [nzLg]="3">
                            <nz-form-item>
                                <nz-form-label>Rate</nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input min="1" placeholder="Rate"
                                        formControlName="pricePerUnit" (input)="onValueChange(i)" />

                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzXs]="12" [nzSm]="6" [nzMd]="3" [nzLg]="3">
                            <nz-form-item>
                                <nz-form-label>Taxable Amt.</nz-form-label>
                                <nz-form-control>
                                    <input readonly [disabled] type="number" nz-input min="0" placeholder="Taxable Amt"
                                        formControlName="taxableAmt" step="any" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <div nz-col [nzXs]="12" [nzSm]="6" [nzMd]="3" [nzLg]="3">
                            <nz-form-item>
                                <nz-form-label>Tax Amt.</nz-form-label>
                                <nz-form-control>
                                    <input [disabled] readonly type="number" nz-input min="0" placeholder="Tax Rate"
                                        formControlName="taxAmt" step="any">

                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <div nz-col [nzXs]="12" [nzSm]="6" [nzMd]="3" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Net Amt. </nz-form-label>
                                <nz-form-control>
                                    <input nz-input placeholder="Net Amount" formControlName="netAmt" readonly
                                        (keydown.enter)="onEnterKeyPress(i)" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </form>

    <!-- END :: FORM SECTION -->

    <!-- BEGIN :: TABLE SECTION -->
    <!-- Table to Display Inventory List -->
    <nz-table #basicTable [nzBordered]="true" [nzData]="selectedItemsListSignal()" [nzSize]="'middle'"
        [nzShowPagination]="'false'">
        <thead>
            <tr>
                <th nzWidth="3%">Sn.</th>
                <th nzWidth="20%">Product Name</th>
                <th nzWidth="10%">Qty.</th>
                <th nzWidth="10%">Rate</th>
                <th nzWidth="10%">Taxable Amt.</th>
                <th nzWidth="10%">Tax Amt.</th>
                <th nzWidth="10%">Net Amt.</th>
                <th nzWidth="10%">Table Actions</th>
            </tr>
        </thead>
        <tbody>
            @for (row of selectedItemsListSignal(); track $index ; ) {
            <tr>
                <td>{{ $index+1 }}.</td>
                <td>{{ row.selectedItem.name }}</td>
                <td>{{ row.qty }}</td>
                <td>{{ row.pricePerUnit }}</td>
                <td>{{ row.taxableAmt|number :'1.2-2' }}</td>
                <td>{{ row.taxAmt|number :'1.2-2' }}</td>
                <td>{{ row.netAmt|number :'1.2-2' }}</td>
                <td>
                    <lib-table-action-buttons [showDeleteButton]="true" (edit)="onEdit(row)"
                        (delete)="onDelete(row.detailId)" />
                </td>

            </tr>
            }
        </tbody>
        <tfoot nzSummary>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>Total</td>
                <td>
                    <span nz-typography nzType=" danger">{{ totalAmountSignal()|number :'1.2-2' }}</span>
                </td>

            </tr>

        </tfoot>
    </nz-table>
    <!-- <lib-form-submit-buttons [showSecondaryButton]="true" [secondaryButtonLabel]="'Cancel'" (primaryAction)="onSave()"
        (secondaryAction)="onCancel()" /> -->
    <nz-divider></nz-divider>

    <div nz-row nzType="flex" nzJustify="end" nzAlign="middle">
        <nz-space nzSize="middle">
            <button *nzSpaceItem nz-button nzType="default" (click)="onCancel()">
                Cancel
            </button>
            <button *nzSpaceItem nz-button nzType="primary" (click)="onSave()">
                <span nz-icon nzType="save" nzTheme="outline"></span>
                Save
            </button>
        </nz-space>
    </div>
    <!-- END :: TABLE SECTION -->

</div>