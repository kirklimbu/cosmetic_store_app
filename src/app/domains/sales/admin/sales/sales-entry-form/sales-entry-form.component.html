<div class="form-container">
    <nz-page-header nzTitle="Add Sales " nzSubtitle="Create new entry">
        <!-- <nz-breadcrumb [nzAutoGenerate]="true" nz-page-header-breadcrumb>
        </nz-breadcrumb> -->
    </nz-page-header>
    <!-- BEGIN :: FORM SECTION -->
    <form nz-form nzLayout="vertical" [formGroup]="form" class="ant-advanced-search-form">
        <div formGroupName="transactionMaster" nz-row nzGutter="24">
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Bill No.</nz-form-label>
                    <nz-form-control>
                        <input nz-input placeholder="Bill no." formControlName="billNo" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Save Date</nz-form-label>
                    <nz-form-control>
                        <input nz-input placeholder="Date" formControlName="saveDate" />
                    </nz-form-control>
                </nz-form-item>
            </div>

            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Pay Type </nz-form-label>
                    <nz-select nz-input placeholder="Select pay type" formControlName="payTypeId">
                        @for (item of payTypeSignal(); track $index) {
                        <nz-option [nzValue]="item.id" [nzLabel]="item.name"></nz-option>
                        }

                    </nz-select>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Patient </nz-form-label>
                    <nz-select nz-input placeholder="Select pay type" formControlName="customerId">
                        @for (item of customerListSignal(); track $index) {
                        <nz-option [nzValue]="item.patientId" [nzLabel]="item.name"></nz-option>
                        }

                    </nz-select>
                </nz-form-item>
            </div>
            <!-- <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Ref Type </nz-form-label>
                    <nz-select nz-input placeholder="Select pay type" formControlName="refType">
                        @for (item of customerListSignal(); track $index) {
                        <nz-option [nzValue]="item" [nzLabel]="item.name"></nz-option>
                        }

                    </nz-select>
                </nz-form-item>
            </div> -->
            <!-- @if(mode =='add') {
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Supplier </nz-form-label>
                    <nz-select nz-input placeholder="Select supplier" formControlName="supplierId">
                        @for (item of supplierListSignal(); track item.supplierId) {
                        <nz-option [nzValue]="item.supplierId" [nzLabel]="item.supplierName"></nz-option>
                        }
                    </nz-select>
                </nz-form-item>
            </div>
            }
            @if(mode =='edit') {
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Supplier </nz-form-label>
                    <nz-select nz-input placeholder="Select supplier" nzDisabled formControlName="supplierId">
                        @for (item of supplierListSignal(); track item.supplierId) {
                        <nz-option [nzValue]="item.supplierId" [nzLabel]="item.supplierName"></nz-option>
                        }
                    </nz-select>
                </nz-form-item>
            </div>
            } -->

            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <!-- RED COLOR INDICATOR -->
                <nz-form-item>
                    <nz-form-label>Total Amount</nz-form-label>
                    <nz-form-control>
                        <input class="totalAmount" disabled nz-input placeholder="Total Amount"
                            [value]="totalAmountSignal()" />
                    </nz-form-control>
                </nz-form-item>
            </div>
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="8">
                <nz-form-item>
                    <nz-form-label>Remarks</nz-form-label>
                    <nz-form-control>
                        <textarea nzAutosize rows="4" nz-input placeholder="Remarks"
                            formControlName="remarks"></textarea>

                    </nz-form-control>
                </nz-form-item>
            </div>
            <!-- formarray -->
        </div>
        <nz-divider></nz-divider>

        <div formArrayName="inventoryList">
            <div *ngFor="let skill of inventoryList.controls let i=index">
                <div [formGroupName]="i">
                    <div nz-row nzGutter="24">
                        <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Product Name </nz-form-label>
                                <nz-select nz-input [nzShowSearch]="true" placeholder="Select product"
                                    formControlName="medicine" (ngModelChange)="patchMedicineValue(i, $event)">
                                    >
                                    @for (item of inventoryListSignal(); track item.inventoryId) {
                                    <nz-option [nzValue]="item" [nzLabel]="item.medicine"></nz-option>
                                    }
                                </nz-select>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Quantity</nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input min="1" placeholder="Quantity" formControlName="qty"
                                        (input)="onValueChange(i,form.get('lastEdited')?.value)" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Rate</nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input min="1" placeholder="Rate" formControlName="rate"
                                        (input)="onValueChange(i,form.get('lastEdited')?.value)" />

                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Discount %</nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input placeholder="Discount %" formControlName="disPercent"
                                        step="any" (blur)="onValueChange(i, 'disPercent')" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Discount Amount </nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input min="0" step="0.01" placeholder="Discount Amount"
                                        formControlName="disAmount" step="any" (blur)="onValueChange(i, 'disAmount')" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                        <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Transaction Amount </nz-form-label>
                                <nz-form-control>
                                    <input nz-input placeholder="Transaction Amount" formControlName="transAmount"
                                        readonly (keydown.enter)="onEnterKeyPress(i)" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </form>

    <!-- END :: FORM SECTION -->

    <!-- BEGIN :: TABLE SECTION -->
    <!-- Table to Display Inventory List -->
    <nz-table #basicTable [nzBordered]="true" [nzData]="selectedItemsListSignal()" [nzSize]="'middle'"
        [nzShowPagination]="'false'">
        <thead>
            <tr>
                <th nzWidth="3%">Sn.</th>
                <th nzWidth="20%">Medicine</th>
                <th nzWidth="10%">Qty</th>
                <th nzWidth="10%">Rate</th>
                <th nzWidth="10%">Discount %</th>
                <th nzWidth="10%">Discount Amount</th>
                <th nzWidth="10%">Total</th>
                <th nzWidth="10%">Table Actions</th>
            </tr>
        </thead>
        <tbody>
            @for (row of selectedItemsListSignal(); track $index ; ) {
            <tr>
                <td>{{ $index+1 }}.</td>
                <td>{{ row.medicine }}</td>
                <td>{{ row.qty }}</td>
                <td>{{ row.rate }}</td>
                <td>{{ row.disPercent |number :'1.1-1'}}</td>
                <td>{{ row.disAmount|number :'1.2-2' }}</td>
                <td>{{ row.transAmount|number :'1.2-2' }}</td>
                <td>
                    <!-- <lib-table-action-buttons [showDeleteButton]="true" (edit)="onEdit(row)"
                        (delete)="onDelete(row.detailId)" /> -->
                </td>

            </tr>
            }
        </tbody>
        <tfoot nzSummary>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>Total</td>
                <td>
                    <span nz-typography nzType=" danger">{{ totalAmountSignal()|number :'1.2-2' }}</span>
                </td>

            </tr>

        </tfoot>
    </nz-table>
    <!-- <lib-form-submit-buttons [showSecondaryButton]="true" [secondaryButtonLabel]="'Cancel'" (primaryAction)="onSave()"
        (secondaryAction)="onCancel()" /> -->
    <nz-divider></nz-divider>

    <div nz-row nzType="flex" nzJustify="end" nzAlign="middle">
        <nz-space nzSize="middle">
            <button *nzSpaceItem nz-button nzType="default" (click)="onCancel()">
                Cancel
            </button>
            <button *nzSpaceItem nz-button nzType="primary" (click)="onSave()">
                <span nz-icon nzType="save" nzTheme="outline"></span>
                Save
            </button>
        </nz-space>
    </div>
    <!-- END :: TABLE SECTION -->

</div>