<div class="form-container">
    <nz-page-header nzTitle="Add Sales Return" nzSubtitle="Create new entry">
        <nz-breadcrumb [nzAutoGenerate]="true" nz-page-header-breadcrumb></nz-breadcrumb>
    </nz-page-header>

    <!-- BEGIN :: FORM SECTION -->
    <form nz-form nzLayout="vertical" [formGroup]="form" class="ant-advanced-search-form">
        <div formGroupName="transactionMaster" nz-row [nzGutter]="16">
            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="5">
                <nz-form-item>
                    <nz-form-label>Bill No.</nz-form-label>
                    <nz-form-control>
                        <input nz-input placeholder="Bill no." formControlName="billNo" />
                    </nz-form-control>
                </nz-form-item>
            </div>

            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="5">
                <nz-form-item>
                    <nz-form-label>Save Date</nz-form-label>
                    <nz-form-control>
                        <input nz-input placeholder="Date" formControlName="saveDate" />
                    </nz-form-control>
                </nz-form-item>
            </div>

            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="5">
                <nz-form-item>
                    <nz-form-label>Pay Type</nz-form-label>
                    <nz-form-control>
                        <nz-select nz-input placeholder="Select pay type" formControlName="payTypeId">
                            <nz-option *ngFor="let item of payTypeSignal()" [nzValue]="item.id"
                                [nzLabel]="item.name"></nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>

            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Condition</nz-form-label>
                    <nz-form-control>
                        <nz-select nz-input placeholder="Select condition" formControlName="condition">
                            <nz-option *ngFor="let item of conditionListSignal()" [nzValue]="item"
                                [nzLabel]="item"></nz-option>
                        </nz-select>
                    </nz-form-control>
                </nz-form-item>
            </div>

            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="4">
                <nz-form-item>
                    <nz-form-label>Total Amount</nz-form-label>
                    <nz-form-control>
                        <input class="totalAmount" disabled nz-input placeholder="Total Amount"
                            [value]="totalAmountSignal()" />
                    </nz-form-control>
                </nz-form-item>
            </div>

            <div nz-col [nzSpan]="24" [nzMd]="8" [nzLg]="5">
                <nz-form-item>
                    <nz-form-label>Remarks</nz-form-label>
                    <nz-form-control>
                        <textarea nzAutosize rows="4" nz-input placeholder="Remarks"
                            formControlName="remarks"></textarea>
                    </nz-form-control>
                </nz-form-item>
            </div>
        </div>

        <nz-divider></nz-divider>

        <div formArrayName="inventoryList">
            <div *ngFor="let skill of inventoryList.controls let i=index">
                <div [formGroupName]="i">
                    <div nz-row [nzGutter]="16">
                        <div nz-col [nzSpan]="24" [nzMd]="6" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Product Name</nz-form-label>
                                <nz-select nz-input [nzShowSearch]="true" placeholder="Select product"
                                    formControlName="medicine" (ngModelChange)="patchMedicineValue(i, $event)">
                                    <nz-option *ngFor="let item of inventoryListSignal()" [nzValue]="item"
                                        [nzLabel]="item.medicine"></nz-option>
                                </nz-select>
                            </nz-form-item>
                        </div>

                        <div nz-col [nzSpan]="24" [nzMd]="6" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Quantity</nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input min="1" placeholder="Quantity" formControlName="qty"
                                        (input)="onValueChange(i,form.get('lastEdited')?.value)" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <div nz-col [nzSpan]="24" [nzMd]="6" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Rate</nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input min="1" placeholder="Rate" formControlName="rate"
                                        (input)="onValueChange(i,form.get('lastEdited')?.value)" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <div nz-col [nzSpan]="24" [nzMd]="6" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Discount %</nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input min="0" placeholder="Discount %"
                                        formControlName="disPercent" (input)="onValueChange(i, 'disPercent')" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <div nz-col [nzSpan]="24" [nzMd]="6" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Discount Amount</nz-form-label>
                                <nz-form-control>
                                    <input type="number" nz-input min="0" placeholder="Discount Amount"
                                        formControlName="disAmount" (input)="onValueChange(i, 'disAmount')" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>

                        <div nz-col [nzSpan]="24" [nzMd]="6" [nzLg]="4">
                            <nz-form-item>
                                <nz-form-label>Transaction Amount</nz-form-label>
                                <nz-form-control>
                                    <input nz-input placeholder="Transaction Amount" formControlName="transAmount"
                                        readonly (keydown.enter)="onEnterKeyPress(i)" />
                                </nz-form-control>
                            </nz-form-item>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>

    <!-- END :: FORM SECTION -->

    <!-- BEGIN :: TABLE SECTION -->
    <nz-table #basicTable [nzBordered]="true" [nzData]="selectedItemsListSignal()" [nzSize]="'middle'"
        [nzShowPagination]="'false'">
        <thead>
            <tr>
                <th nzWidth="3%">Sn.</th>
                <th nzWidth="20%">Medicine</th>
                <th nzWidth="10%">Qty</th>
                <th nzWidth="10%">Rate</th>
                <th nzWidth="10%">Discount %</th>
                <th nzWidth="10%">Discount Amount</th>
                <th nzWidth="10%">Total</th>
                <th nzWidth="10%">Table Actions</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let row of selectedItemsListSignal(); let index$">
                <td>{{ index$+1 }}.</td>
                <td>{{ row.medicine }}</td>
                <td>{{ row.qty }}</td>
                <td>{{ row.rate }}</td>
                <td>{{ row.disPercent | number:'1.1-1' }}</td>
                <td>{{ row.disAmount | number:'1.2-2' }}</td>
                <td>{{ row.transAmount | number:'1.2-2' }}</td>
                <td>
                    <!-- <lib-table-action-buttons [showDeleteButton]="true" (edit)="onEdit(row)" (delete)="onDelete(row.detailId)" /> -->
                </td>
            </tr>
        </tbody>
        <tfoot nzSummary>
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td>Total</td>
                <td>
                    <span nz-typography nzType="danger">{{ totalAmountSignal() | number:'1.2-2' }}</span>
                </td>
            </tr>
        </tfoot>
    </nz-table>
    <nz-divider></nz-divider>

    <div nz-row nzType="flex" nzJustify="end" nzAlign="middle">
        <nz-space nzSize="middle">
            <button *nzSpaceItem nz-button nzType="default" (click)="onCancel()">Cancel</button>
            <button *nzSpaceItem nz-button nzType="primary" (click)="onSave()">
                <span nz-icon nzType="save" nzTheme="outline"></span> Save
            </button>
        </nz-space>
    </div>
    <!-- END :: TABLE SECTION -->
</div>